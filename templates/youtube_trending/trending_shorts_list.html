{% extends 'base.html' %}
{% load static %}

{% block title %}ğŸ”¥ ì¸ê¸° íŠ¸ë Œë”© ì‡¼ì¸ {% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #ff0000;
        --primary-light: #ff4444;
        --primary-dark: #cc0000;
        --secondary-color: #333;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
        --light-bg: #f8f9fa;
        --white: #ffffff;
        --gray-100: #f8f9fa;
        --gray-200: #e9ecef;
        --gray-300: #dee2e6;
        --gray-400: #ced4da;
        --gray-500: #adb5bd;
        --gray-600: #6c757d;
        --gray-700: #495057;
        --gray-800: #343a40;
        --gray-900: #212529;
        --border-color: #dee2e6;
        --text-muted: #6c757d;
        --shadow-sm: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        --shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
        --shadow-lg: 0 1rem 3rem rgba(0,0,0,0.175);
        --border-radius: 12px;
        --border-radius-sm: 8px;
        --border-radius-lg: 16px;
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        font-size: 14px;
        line-height: 1.6;
    }

    .main-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 1rem;
    }

    /* Header Section */
    .header-section {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
        text-align: center;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
    }

    .page-title {
        color: var(--primary-color);
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        letter-spacing: -0.5px;
    }

    .page-subtitle {
        color: var(--gray-600);
        font-size: 1.2rem;
        margin-bottom: 2rem;
        font-weight: 500;
    }

    /* Stats Section */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: var(--white);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        text-align: center;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
        pointer-events: none;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        display: block;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
    }

    /* Controls Section */
    .controls-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
    }

    .controls-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .form-label {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 0.9rem;
        letter-spacing: 0.3px;
    }

    .form-control, .form-select {
        padding: 0.75rem 1rem;
        border: 2px solid var(--gray-300);
        border-radius: var(--border-radius-sm);
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: var(--white);
    }

    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        transform: translateY(-1px);
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: var(--border-radius-sm);
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        cursor: pointer;
        font-size: 0.9rem;
        letter-spacing: 0.3px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: var(--white);
        box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
    }

    .btn-outline:hover {
        background: var(--primary-color);
        color: var(--white);
        transform: translateY(-2px);
    }

    /* Shorts Grid */
    .shorts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .shorts-card {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        border: 1px solid var(--gray-200);
    }

    .shorts-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
    }

    /* Card Header with Thumbnail */
    .card-header {
        position: relative;
        overflow: hidden;
        height: 240px;
        background: var(--gray-100);
    }

    .thumbnail-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .shorts-thumbnail {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.4s ease;
    }

    .shorts-card:hover .shorts-thumbnail {
        transform: scale(1.1);
    }

    .rank-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: var(--white);
        font-weight: 800;
        font-size: 1.1rem;
        padding: 0.5rem 0.8rem;
        border-radius: 20px;
        box-shadow: var(--shadow);
        z-index: 2;
    }

    .duration-badge {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.8);
        color: var(--white);
        font-weight: 600;
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
        border-radius: 12px;
        backdrop-filter: blur(10px);
    }

    .play-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: var(--primary-color);
        opacity: 0;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .shorts-card:hover .play-overlay {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
    }

    /* Card Body */
    .card-body {
        padding: 1.5rem;
    }

    .shorts-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 0.8rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 2.8rem;
    }

    .channel-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
        color: var(--gray-600);
        font-size: 0.9rem;
        padding: 0.5rem 0.8rem;
        background: var(--gray-50);
        border-radius: var(--border-radius-sm);
        border-left: 3px solid var(--primary-color);
    }

    .channel-name {
        font-weight: 600;
        color: var(--gray-700);
    }

    /* Stats Row */
    .stats-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 0.8rem;
        margin-bottom: 1.2rem;
    }

    .stat-item {
        text-align: center;
        padding: 1rem 0.6rem;
        background: var(--gray-100);
        border-radius: var(--border-radius-sm);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-color);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .stat-item:hover {
        background: var(--gray-200);
        transform: translateY(-3px);
        box-shadow: var(--shadow-sm);
    }

    .stat-item:hover::before {
        transform: scaleX(1);
    }

    .stat-icon {
        font-size: 1.4rem;
        margin-bottom: 0.4rem;
        display: block;
    }

    .view-icon { color: var(--primary-color); }
    .like-icon { color: var(--danger-color); }
    .comment-icon { color: var(--info-color); }

    .stat-value {
        font-weight: 800;
        color: var(--gray-800);
        font-size: 1rem;
        display: block;
        margin-bottom: 0.2rem;
    }

    .stat-label-small {
        font-size: 0.7rem;
        color: var(--gray-500);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    /* Enhanced Stats Display */
    .detailed-stats {
        background: var(--gray-50);
        border-radius: var(--border-radius-sm);
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--primary-color);
    }

    .detailed-stats-title {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.8rem;
    }

    .stats-item {
        text-align: center;
        padding: 0.8rem 0.5rem;
        background: var(--white);
        border-radius: var(--border-radius-sm);
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
    }

    .stats-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    .stats-item-icon {
        font-size: 1.3rem;
        margin-bottom: 0.3rem;
        display: block;
    }

    .stats-item-value {
        font-weight: 800;
        font-size: 0.95rem;
        display: block;
        margin-bottom: 0.2rem;
    }

    .stats-item-label {
        font-size: 0.7rem;
        color: var(--gray-500);
        text-transform: uppercase;
        letter-spacing: 0.3px;
        font-weight: 600;
    }

    /* Card Footer */
    .card-footer {
        padding: 1rem 1.5rem;
        background: var(--gray-50);
        border-top: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .category-badge {
        background: var(--info-color);
        color: var(--white);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .watch-btn {
        background: var(--primary-color);
        color: var(--white);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .watch-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.05);
        text-decoration: none;
        color: var(--white);
    }

    /* Loading and Empty States */
    .loading-container {
        text-align: center;
        padding: 4rem 2rem;
    }

    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--gray-300);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--gray-600);
    }

    .empty-icon {
        font-size: 4rem;
        color: var(--gray-400);
        margin-bottom: 1rem;
    }

    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 3rem;
    }

    .pagination-btn {
        padding: 0.5rem 1rem;
        background: var(--white);
        border: 2px solid var(--gray-300);
        border-radius: var(--border-radius-sm);
        color: var(--gray-700);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .pagination-btn:hover:not(.disabled) {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-1px);
    }

    .pagination-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-info {
        color: var(--gray-600);
        font-weight: 500;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .main-container {
            padding: 0.5rem;
        }
        
        .page-title {
            font-size: 1.8rem;
        }
        
        .shorts-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .controls-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-container {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .stat-card {
            padding: 1rem;
        }
        
        .stat-number {
            font-size: 1.8rem;
        }
        
        .stat-label {
            font-size: 0.8rem;
        }
    }

    @media (max-width: 480px) {
        .page-title {
            font-size: 1.5rem;
        }
        
        .page-subtitle {
            font-size: 1rem;
        }
        
        .card-body {
            padding: 1rem;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        
        .stats-item {
            padding: 0.6rem 0.4rem;
        }
        
        .stats-item-icon {
            font-size: 1.1rem;
        }
        
        .stats-item-value {
            font-size: 0.85rem;
        }
        
        .detailed-stats {
            padding: 0.8rem;
        }
        
        .card-footer {
            flex-direction: column;
            gap: 0.5rem;
            align-items: stretch;
        }
        
        .watch-btn {
            justify-content: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
        }
        
        .stats-container {
            grid-template-columns: 1fr;
            gap: 0.8rem;
        }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        :root {
            --white: #1e1e1e;
            --gray-100: #2d2d2d;
            --gray-200: #3d3d3d;
            --gray-800: #e0e0e0;
            --gray-700: #f0f0f0;
        }
    }

    /* Animation enhancements */
    .shorts-card {
        animation: fadeInUp 0.6s ease forwards;
        opacity: 0;
        transform: translateY(30px);
    }

    .shorts-card:nth-child(1) { animation-delay: 0.1s; }
    .shorts-card:nth-child(2) { animation-delay: 0.2s; }
    .shorts-card:nth-child(3) { animation-delay: 0.3s; }
    .shorts-card:nth-child(4) { animation-delay: 0.4s; }
    .shorts-card:nth-child(5) { animation-delay: 0.5s; }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="main-container">
    <!-- Header Section -->
    <div class="header-section">
        <h1 class="page-title">
            ğŸ”¥ ì¸ê¸° íŠ¸ë Œë”© ì‡¼ì¸ 
        </h1>
        <p class="page-subtitle">
            ë§¤ì¼ ì—…ë°ì´íŠ¸ë˜ëŠ” ìµœì‹  íŠ¸ë Œë”© YouTube Shortsë¥¼ í™•ì¸í•˜ì„¸ìš”
        </p>
        
        <!-- Stats Container -->
        <div class="stats-container">
            <div class="stat-card">
                <span class="stat-number" id="total-shorts">-</span>
                <span class="stat-label">Total Shorts</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="total-views">-</span>
                <span class="stat-label">Total Views</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="avg-duration">-</span>
                <span class="stat-label">Avg Duration</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="last-updated">-</span>
                <span class="stat-label">Last Updated</span>
            </div>
        </div>
    </div>

    <!-- Controls Section -->
    <div class="controls-section">
        <div class="controls-grid">
            <div class="form-group">
                <label class="form-label">ğŸ“… ë‚ ì§œ ì„ íƒ</label>
                <input type="date" id="date-filter" class="form-control" 
                       value="{{ today|date:'Y-m-d' }}" max="{{ today|date:'Y-m-d' }}">
            </div>
            <div class="form-group">
                <label class="form-label">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</label>
                <select id="category-filter" class="form-select">
                    <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                    <option value="music">ìŒì•…</option>
                    <option value="gaming">ê²Œì„</option>
                    <option value="entertainment">ì—”í„°í…Œì¸ë¨¼íŠ¸</option>
                    <option value="comedy">ì½”ë¯¸ë””</option>
                    <option value="sports">ìŠ¤í¬ì¸ </option>
                    <option value="education">êµìœ¡</option>
                    <option value="tech">ê³¼í•™ê¸°ìˆ </option>
                    <option value="lifestyle">ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
                    <option value="other">ê¸°íƒ€</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ğŸ“Š í‘œì‹œ ê°œìˆ˜</label>
                <select id="limit-filter" class="form-select">
                    <option value="15">15ê°œ</option>
                    <option value="10">10ê°œ</option>
                    <option value="20">20ê°œ</option>
                    <option value="30">30ê°œ</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">&nbsp;</label>
                <button type="button" class="btn btn-primary" onclick="loadShorts()">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div id="loading-container" class="loading-container" style="display: none;">
        <div class="loading-spinner"></div>
        <p>íŠ¸ë Œë”© ì‡¼ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- Shorts Grid -->
    <div id="shorts-grid" class="shorts-grid">
        <!-- ì‡¼ì¸  ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="empty-state" style="display: none;">
        <div class="empty-icon">ğŸ“­</div>
        <h3>ì‡¼ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ì„ íƒí•œ ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë”© ì‡¼ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        <button type="button" class="btn btn-outline" onclick="resetFilters()">
            í•„í„° ì´ˆê¸°í™”
        </button>
    </div>

    <!-- Pagination -->
    <div id="pagination-container" class="pagination-container" style="display: none;">
        <a href="#" id="prev-page" class="pagination-btn">
            â† ì´ì „
        </a>
        <span id="pagination-info" class="pagination-info"></span>
        <a href="#" id="next-page" class="pagination-btn">
            ë‹¤ìŒ â†’
        </a>
    </div>
</div>

<script>
let currentPage = 1;
let totalPages = 1;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
document.addEventListener('DOMContentLoaded', function() {
    loadShorts();
    setupEventListeners();
});

function setupEventListeners() {
    // í•„í„° ë³€ê²½ ì‹œ ìë™ ë¡œë“œ
    ['date-filter', 'category-filter', 'limit-filter'].forEach(id => {
        document.getElementById(id).addEventListener('change', () => {
            currentPage = 1;
            loadShorts();
        });
    });

    // í˜ì´ì§€ë„¤ì´ì…˜ ì´ë²¤íŠ¸
    document.getElementById('prev-page').addEventListener('click', function(e) {
        e.preventDefault();
        if (currentPage > 1) {
            currentPage--;
            loadShorts();
        }
    });

    document.getElementById('next-page').addEventListener('click', function(e) {
        e.preventDefault();
        if (currentPage < totalPages) {
            currentPage++;
            loadShorts();
        }
    });
}

function loadShorts() {
    const loadingContainer = document.getElementById('loading-container');
    const shortsGrid = document.getElementById('shorts-grid');
    const emptyState = document.getElementById('empty-state');
    const paginationContainer = document.getElementById('pagination-container');

    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    loadingContainer.style.display = 'block';
    shortsGrid.style.display = 'none';
    emptyState.style.display = 'none';
    paginationContainer.style.display = 'none';

    // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
    const date = document.getElementById('date-filter').value;
    const category = document.getElementById('category-filter').value;
    const limit = document.getElementById('limit-filter').value;

    // API í˜¸ì¶œ
    const params = new URLSearchParams({
        date: date,
        category: category,
        limit: limit,
        page: currentPage
    });

    fetch(`{% url 'youtube_trending:trending_shorts_api' %}?${params}`)
        .then(response => response.json())
        .then(data => {
            loadingContainer.style.display = 'none';
            
            if (data.success && data.shorts.length > 0) {
                renderShorts(data.shorts);
                updateStats(data.shorts);
                updatePagination(data.pagination);
                shortsGrid.style.display = 'grid';
            } else {
                emptyState.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error loading shorts:', error);
            loadingContainer.style.display = 'none';
            emptyState.style.display = 'block';
        });
}

function renderShorts(shorts) {
    const grid = document.getElementById('shorts-grid');
    grid.innerHTML = '';

    shorts.forEach((shortItem, index) => {
        const card = createShortsCard(shortItem, index + 1);
        grid.appendChild(card);
    });
}

function createShortsCard(shortItem, displayRank) {
    const card = document.createElement('div');
    card.className = 'shorts-card';
    card.style.animationDelay = `${displayRank * 0.1}s`;

    const thumbnailUrl = shortItem.thumbnail_url || '/static/images/default-thumbnail.jpg';
    const categoryColor = getCategoryColor(shortItem.category);
    
    // ì‹¤ì œ íŠ¸ë Œë”© ìˆœìœ„ê°€ ìˆìœ¼ë©´ ì‚¬ìš©í•˜ê³ , ì—†ìœ¼ë©´ í‘œì‹œ ìˆœìœ„ ì‚¬ìš©
    const actualRank = shortItem.trending_rank || displayRank;
    
    // ë°œí–‰ì¼ í¬ë§·íŒ…
    const publishedDate = shortItem.published_at ? 
        new Date(shortItem.published_at).toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'short', 
            day: 'numeric'
        }) : 'ë‚ ì§œ ë¯¸ìƒ';

    card.innerHTML = `
        <div class="card-header">
            <div class="thumbnail-container">
                <img src="${thumbnailUrl}" alt="${shortItem.title}" class="shorts-thumbnail"
                     onerror="this.src='/static/images/default-thumbnail.jpg'">
                <div class="rank-badge">#${actualRank}</div>
                <div class="duration-badge">${shortItem.duration || '< 1ë¶„'}</div>
                <div class="play-overlay">â–¶</div>
            </div>
        </div>
        
        <div class="card-body">
            <h3 class="shorts-title">${shortItem.title}</h3>
            
            <div class="channel-info">
                <span class="channel-name">ğŸ“º ${shortItem.channel_title || 'Unknown Channel'}</span>
            </div>
            
            <div class="detailed-stats">
                <div class="detailed-stats-title">ğŸ“Š ìƒì„¸ í†µê³„</div>
                <div class="stats-grid">
                    <div class="stats-item">
                        <span class="stats-item-icon view-icon">ğŸ‘ï¸</span>
                        <span class="stats-item-value">${formatNumber(shortItem.view_count)}</span>
                        <span class="stats-item-label">ì¡°íšŒìˆ˜</span>
                    </div>
                    <div class="stats-item">
                        <span class="stats-item-icon like-icon">â¤ï¸</span>
                        <span class="stats-item-value">${formatNumber(shortItem.like_count)}</span>
                        <span class="stats-item-label">ì¢‹ì•„ìš”</span>
                    </div>
                    <div class="stats-item">
                        <span class="stats-item-icon comment-icon">ğŸ’¬</span>
                        <span class="stats-item-value">${formatNumber(shortItem.comment_count)}</span>
                        <span class="stats-item-label">ëŒ“ê¸€</span>
                    </div>
                </div>
            </div>
            
            <div class="meta-info" style="font-size: 0.8rem; color: var(--gray-500); margin-bottom: 1rem;">
                ğŸ“… ë°œí–‰ì¼: ${publishedDate} | ğŸ† ìˆœìœ„: #${actualRank}
            </div>
        </div>
        
        <div class="card-footer">
            <span class="category-badge" style="background-color: ${categoryColor}">
                ${shortItem.category}
            </span>
            <a href="${shortItem.youtube_url}" target="_blank" class="watch-btn">
                â–¶ ì‹œì²­í•˜ê¸°
            </a>
        </div>
    `;

    return card;
}

function updateStats(shorts) {
    const totalShorts = shorts.length;
    const totalViews = shorts.reduce((sum, s) => sum + (s.view_count || 0), 0);
    const avgDuration = "< 1ë¶„"; // ì‡¼ì¸ ëŠ” ëŒ€ë¶€ë¶„ 1ë¶„ ë¯¸ë§Œ
    const lastUpdated = new Date().toLocaleDateString('ko-KR');

    document.getElementById('total-shorts').textContent = totalShorts;
    document.getElementById('total-views').textContent = formatNumber(totalViews);
    document.getElementById('avg-duration').textContent = avgDuration;
    document.getElementById('last-updated').textContent = lastUpdated;
}

function updatePagination(pagination) {
    const container = document.getElementById('pagination-container');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    const info = document.getElementById('pagination-info');

    if (pagination.total_pages > 1) {
        container.style.display = 'flex';
        
        prevBtn.classList.toggle('disabled', !pagination.has_previous);
        nextBtn.classList.toggle('disabled', !pagination.has_next);
        
        info.textContent = `${pagination.current_page} / ${pagination.total_pages} í˜ì´ì§€`;
        
        totalPages = pagination.total_pages;
    } else {
        container.style.display = 'none';
    }
}

function formatNumber(num) {
    if (!num || num === 0) return '0';
    
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toLocaleString();
}

function getCategoryColor(category) {
    const colors = {
        'music': '#ff6b6b',
        'gaming': '#4ecdc4',
        'entertainment': '#45b7d1',
        'comedy': '#f9ca24',
        'sports': '#f0932b',
        'education': '#eb4d4b',
        'tech': '#6c5ce7',
        'lifestyle': '#a29bfe',
        'other': '#74b9ff'
    };
    return colors[category] || colors['other'];
}

function resetFilters() {
    document.getElementById('date-filter').value = '{{ today|date:"Y-m-d" }}';
    document.getElementById('category-filter').value = 'all';
    document.getElementById('limit-filter').value = '15';
    currentPage = 1;
    loadShorts();
}

// í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft' && currentPage > 1) {
        currentPage--;
        loadShorts();
    } else if (e.key === 'ArrowRight' && currentPage < totalPages) {
        currentPage++;
        loadShorts();
    } else if (e.key === 'r' || e.key === 'R') {
        e.preventDefault();
        loadShorts();
    }
});
</script>
{% endblock %} 
{% endblock %} 