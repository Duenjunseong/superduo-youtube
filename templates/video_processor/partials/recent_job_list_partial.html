{% if recent_jobs %}
    <ul class="list-group list-group-flush recent-jobs-list">
        {% for job in recent_jobs %}
            <li class="list-group-item" data-job-id="{{ job.job_id }}" data-job-status="{{ job.status }}">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1 pe-3">
                        <a href="{% url 'video_processor:job_status' job_id=job.job_id %}" title="{{ job.youtube_url }}" class="text-decoration-none">
                            {% if job.video_title %}
                                {{ job.video_title|truncatechars:40 }}
                            {% else %}
                                제목 미탐지
                            {% endif %}
                            <i class="fas fa-external-link-alt ms-1" style="font-size:0.8em;"></i>
                        </a>
                        <br>
                        <small class="text-muted">
                            {% if job.group %}{{ job.group.name|truncatechars:20 }} | {% endif %}
                            {{ job.created_at|date:"y-m-d H:i" }}
                        </small>
                        
                        {% comment %} 진행상태 표시 - 최근 작업 목록용 (간격 조정) {% endcomment %}
                        {% if job.status == 'PROCESSING' or job.status == 'DOWNLOADING' %}
                            <div class="job-progress-container mt-2" style="max-width: 90%;">
                                <div class="progress" style="height: 4px;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated job-progress-bar"
                                         role="progressbar" style="width: 0%" aria-valuenow="0" 
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <small class="text-muted job-progress-text">
                                    {% if job.status == 'DOWNLOADING' %}다운로드 중...{% elif job.status == 'PROCESSING' %}처리 중...{% endif %}
                                    <span class="job-progress-percentage">0%</span>
                                </small>
                            </div>
                        {% elif job.status == 'COMPLETED' %}
                            <div class="job-completion-container mt-2" style="max-width: 90%;">
                                <div class="progress" style="height: 4px;">
                                    <div class="progress-bar bg-success job-completion-bar"
                                         role="progressbar" style="width: 100%" aria-valuenow="100" 
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <small class="text-success"><i class="fas fa-check-circle me-1"></i>완료</small>
                            </div>
                        {% endif %}
                    </div>
                    <div class="d-flex flex-column align-items-end flex-shrink-0" style="min-width: 120px;">
                        <span class="badge mb-2 job-status-badge
                            {% if job.status == 'COMPLETED' %}bg-success
                            {% elif job.status == 'PROCESSING' or job.status == 'DOWNLOADING' %}bg-primary
                            {% elif job.status == 'PENDING' %}bg-secondary
                            {% elif job.status == 'FAILED' %}bg-danger
                            {% else %}bg-dark{% endif %}" style="min-width: 70px; text-align: center;">
                            {{ job.get_status_display }}
                        </span>
                        
                        {# 상태별 버튼 표시 #}
                        {% if job.status == 'COMPLETED' %}
                            {# 완료된 작업: 다운로드 버튼들 표시 #}
                            <div class="btn-group-vertical btn-group-sm" role="group">
                                {% comment %} 완료된 세그먼트가 있으면 압축 다운로드 버튼 표시 {% endcomment %}
                                {% if job.segments.all %}
                                    <a href="{% url 'video_processor:job_download_zip' job_id=job.job_id %}" 
                                       class="btn btn-primary btn-sm mb-1" 
                                       title="모든 세그먼트 압축 다운로드">
                                        <i class="fas fa-file-archive me-1"></i><span class="d-none d-sm-inline">압축</span>
                                    </a>
                                {% endif %}
                                
                                {% for segment in job.segments.all %}
                                    {% if segment.status == 'COMPLETED' and segment.processed_file_path %}
                                        <a href="/media/{{ segment.processed_file_path }}" 
                                           class="btn btn-success btn-sm mb-1" 
                                           download
                                           title="세그먼트 {{ forloop.counter }} 다운로드">
                                            <i class="fas fa-download me-1"></i><span class="d-none d-sm-inline">{% if segment.output_filename_prefix %}{{ segment.output_filename_prefix|truncatechars:6 }}{% else %}#{{ forloop.counter }}{% endif %}</span>
                                        </a>
                                    {% endif %}
                                {% endfor %}
                                
                                {# 완료된 작업 삭제 버튼 추가 #}
                                <button type="button" 
                                        class="btn btn-outline-danger btn-sm delete-job-btn" 
                                        data-job-id="{{ job.job_id }}"
                                        data-job-title="{% if job.video_title %}{{ job.video_title|truncatechars:20 }}{% else %}작업 {{ job.job_id|slice:':8' }}{% endif %}"
                                        title="삭제">
                                    <i class="fas fa-trash me-1"></i><span class="d-none d-sm-inline">삭제</span>
                                </button>
                            </div>
                        {% elif job.status == 'FAILED' %}
                            {# 실패한 작업: 재시도 및 삭제 버튼 #}
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" 
                                        class="btn btn-warning btn-sm retry-job-btn" 
                                        data-job-id="{{ job.job_id }}"
                                        data-job-title="{% if job.video_title %}{{ job.video_title|truncatechars:20 }}{% else %}작업 {{ job.job_id|slice:':8' }}{% endif %}"
                                        title="재시도">
                                    <i class="fas fa-redo"></i><span class="d-none d-lg-inline ms-1">재시도</span>
                                </button>
                                <button type="button" 
                                        class="btn btn-danger btn-sm delete-job-btn" 
                                        data-job-id="{{ job.job_id }}"
                                        data-job-title="{% if job.video_title %}{{ job.video_title|truncatechars:20 }}{% else %}작업 {{ job.job_id|slice:':8' }}{% endif %}"
                                        title="삭제">
                                    <i class="fas fa-trash"></i><span class="d-none d-lg-inline ms-1">삭제</span>
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-muted p-3">최근 제출된 작업이 없습니다.</p>
{% endif %} 